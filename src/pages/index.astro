---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';
import invector from '../content/invector/imgs/invector.webp';
import CategoryFilter from '../components/CategoryFilter.astro';
import type { Category } from '../consts/variables'
const posts = await getCollection('post');

const getCategories = () => {
  const categoryMap: Category[] = [];
  posts.forEach(post => {
    const matchedCategory = categoryMap.find(category => category.id == post.data.category.id);
    if (matchedCategory) {
      matchedCategory.count++;
    } else {
      categoryMap.push({ name: post.data.category.name, count: 1, id: post.data.category.id });
    }
  });
  
  return categoryMap;
}
---

<Layout>
	<div class="row">
    <div class="col">
      <p>記事一覧</p>
    </div>
  </div>
  <div class="row">
    <CategoryFilter categories={getCategories()} />
    <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvas" aria-controls="offcanvas">hiraku</button>
    <div class="col-lg-3 col-md-6 col-sm-12">
      <Card 
        title="Invector"
        description="TPSコントローラー"
        thumbnail={invector}
        href='/UnityContent/invector'
      />
    </div>
    {
      posts.map((post) => (
        <div class="col-lg-3 col-md-6 col-sm-12">
          <Card
            title={post.data.title}
            description={post.data.description}
            thumbnail={post.data.thumbnail}
            href={`/UnityContent/post/${post.slug}`}
          />
        </div>
      ))
    }
  </div>
</Layout>